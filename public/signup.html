<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - 알비</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .input-focus:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-8">
        <div class="max-w-md mx-auto px-4 text-center">
            <div class="text-5xl mb-3">🐜</div>
            <h1 class="text-3xl font-bold mb-2">알비 회원가입</h1>
            <p class="text-white/90">1시간 체험으로 시작하는 새로운 일자리</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-md mx-auto px-4 py-8">
        <!-- 추천 코드 보너스 알림 (추천 코드가 있을 때만 표시) -->
        <div id="referralBonus" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-2xl p-6 mb-6 shadow-lg fade-in hidden">
            <div class="flex items-center gap-3 mb-3">
                <div class="text-4xl">🎁</div>
                <div>
                    <div class="font-bold text-lg">축하합니다!</div>
                    <div class="text-sm text-white/90">추천 코드로 가입하시면</div>
                </div>
            </div>
            <div class="text-3xl font-bold text-center">
                즉시 20P 지급!
            </div>
        </div>

        <!-- 회원가입 폼 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 fade-in">
            <form id="signupForm" class="space-y-4">
                <!-- 이름 -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-user mr-1 text-purple-600"></i>
                        이름
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        required
                        class="input-focus w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none transition-all"
                        placeholder="홍길동"
                    >
                </div>

                <!-- 이메일 -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-envelope mr-1 text-purple-600"></i>
                        이메일
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        required
                        class="input-focus w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none transition-all"
                        placeholder="albi@example.com"
                    >
                </div>

                <!-- 사용자 유형 -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-briefcase mr-1 text-purple-600"></i>
                        가입 유형
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="userType" value="jobseeker" class="peer hidden" checked>
                            <div class="peer-checked:border-purple-600 peer-checked:bg-purple-50 peer-checked:text-purple-600 border-2 border-gray-200 rounded-lg p-4 text-center transition-all hover:border-purple-400">
                                <i class="fas fa-user text-2xl mb-2"></i>
                                <div class="font-bold">구직자</div>
                                <div class="text-xs text-gray-500">일자리 찾기</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="userType" value="employer" class="peer hidden">
                            <div class="peer-checked:border-purple-600 peer-checked:bg-purple-50 peer-checked:text-purple-600 border-2 border-gray-200 rounded-lg p-4 text-center transition-all hover:border-purple-400">
                                <i class="fas fa-building text-2xl mb-2"></i>
                                <div class="font-bold">구인자</div>
                                <div class="text-xs text-gray-500">인재 찾기</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 추천 코드 (URL에서 자동 입력) -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-gift mr-1 text-purple-600"></i>
                        추천 코드 (선택)
                    </label>
                    <input 
                        type="text" 
                        id="referralCode" 
                        class="input-focus w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none transition-all uppercase"
                        placeholder="ALBI123456"
                        maxlength="10"
                    >
                    <p class="text-xs text-gray-500 mt-1">
                        추천 코드가 있으면 즉시 20P를 받을 수 있어요!
                    </p>
                </div>

                <!-- 약관 동의 -->
                <div class="border-t-2 border-gray-100 pt-4 space-y-3">
                    <label class="flex items-start gap-2 cursor-pointer">
                        <input type="checkbox" id="agreeAll" class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                        <span class="text-sm font-bold text-gray-700">
                            전체 동의
                        </span>
                    </label>
                    <label class="flex items-start gap-2 cursor-pointer ml-4">
                        <input type="checkbox" class="agree-item mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded" required>
                        <span class="text-sm text-gray-600">
                            [필수] 서비스 이용약관 동의
                        </span>
                    </label>
                    <label class="flex items-start gap-2 cursor-pointer ml-4">
                        <input type="checkbox" class="agree-item mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded" required>
                        <span class="text-sm text-gray-600">
                            [필수] 개인정보 처리방침 동의
                        </span>
                    </label>
                    <label class="flex items-start gap-2 cursor-pointer ml-4">
                        <input type="checkbox" class="agree-item mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded">
                        <span class="text-sm text-gray-600">
                            [선택] 마케팅 정보 수신 동의
                        </span>
                    </label>
                </div>

                <!-- 가입 버튼 -->
                <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg"
                >
                    <i class="fas fa-check-circle mr-2"></i>
                    회원가입 완료
                </button>
            </form>
        </div>

        <!-- 로그인 링크 -->
        <div class="text-center text-gray-600">
            이미 계정이 있으신가요?
            <a href="/" class="text-purple-600 font-bold hover:text-purple-700">
                로그인
            </a>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        // URL에서 추천 코드 가져오기
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 페이지 로드 시 추천 코드 자동 입력
        document.addEventListener('DOMContentLoaded', () => {
            const referralCode = getQueryParam('ref');
            if (referralCode) {
                document.getElementById('referralCode').value = referralCode.toUpperCase();
                document.getElementById('referralCode').readOnly = true;
                document.getElementById('referralBonus').classList.remove('hidden');
            }
        });

        // 전체 동의 체크박스
        document.getElementById('agreeAll').addEventListener('change', (e) => {
            const checkboxes = document.querySelectorAll('.agree-item');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        });

        // 개별 체크박스 변경 시 전체 동의 상태 업데이트
        document.querySelectorAll('.agree-item').forEach(cb => {
            cb.addEventListener('change', () => {
                const allChecked = [...document.querySelectorAll('.agree-item')].every(cb => cb.checked);
                document.getElementById('agreeAll').checked = allChecked;
            });
        });

        // 회원가입 처리
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const userType = document.querySelector('input[name="userType"]:checked').value;
            const referralCode = document.getElementById('referralCode').value.trim();

            // 필수 약관 동의 확인
            const requiredChecks = [...document.querySelectorAll('.agree-item')]
                .filter(cb => cb.required);
            const allRequiredChecked = requiredChecks.every(cb => cb.checked);

            if (!allRequiredChecked) {
                showNotification('필수 약관에 동의해주세요.', 'error');
                return;
            }

            try {
                // 1. 사용자 생성 (실제로는 백엔드 API 호출)
                const userId = 'user_' + Date.now();
                
                // 임시: 로컬 스토리지에 사용자 정보 저장
                localStorage.setItem('albi_user_id', userId);
                localStorage.setItem('albi_user_info', JSON.stringify({
                    id: userId,
                    name,
                    email,
                    userType,
                    points: 20 // 기본 가입 포인트
                }));
                
                let bonusPoints = 20;

                // 2. 추천 코드가 있으면 추천 등록 및 20P 추가 지급
                if (referralCode) {
                    try {
                        const response = await axios.post('/api/referral/register', {
                            refereeId: userId,
                            referralCode: referralCode
                        });

                        if (response.data.success) {
                            bonusPoints = response.data.data.bonusPoints;
                            const newBalance = response.data.data.newBalance;
                            
                            // 포인트 업데이트
                            localStorage.setItem('albi_points', newBalance);
                            
                            showNotification(`회원가입 완료! ${bonusPoints}P가 지급되었습니다! 🎉`, 'success');
                        } else {
                            // 추천 코드가 유효하지 않아도 가입은 진행
                            console.warn('Referral registration failed:', response.data.error);
                            localStorage.setItem('albi_points', 20);
                            showNotification('회원가입 완료! 기본 20P가 지급되었습니다.', 'success');
                        }
                    } catch (error) {
                        console.error('Referral registration error:', error);
                        localStorage.setItem('albi_points', 20);
                        showNotification('회원가입 완료! 기본 20P가 지급되었습니다.', 'success');
                    }
                } else {
                    localStorage.setItem('albi_points', 20);
                    showNotification('회원가입 완료! 20P가 지급되었습니다! 🎉', 'success');
                }

                // 3. 온보딩 페이지로 이동 (또는 메인 페이지)
                setTimeout(() => {
                    window.location.href = '/onboarding';
                }, 2000);

            } catch (error) {
                console.error('Signup error:', error);
                showNotification('회원가입 중 오류가 발생했습니다.', 'error');
            }
        });

        // 알림 표시
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-bold fade-in ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
