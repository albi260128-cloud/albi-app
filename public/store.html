<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•Œë¹„ ìŠ¤í† ì–´ - ì•Œë¹„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes slideUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .slide-up { animation: slideUp 0.3s ease-out; }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-500px) rotate(720deg); opacity: 0; }
    }
    .confetti { animation: confetti 2s ease-out forwards; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-md mx-auto min-h-screen p-4 pb-20">
    <!-- í—¤ë” -->
    <div class="text-center mb-8 pt-8">
      <div class="text-6xl mb-4">ğŸ</div>
      <h1 class="text-2xl font-bold mb-2">ì•Œë¹„ ìŠ¤í† ì–´</h1>
      <p class="text-gray-600">í¬ì¸íŠ¸ë¡œ ë‹¤ì–‘í•œ ê¸°í”„í‹°ì½˜ì„ êµí™˜í•˜ì„¸ìš”!</p>
    </div>

    <!-- í¬ì¸íŠ¸ ì”ì•¡ ì¹´ë“œ -->
    <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl shadow-lg p-6 text-white mb-8 text-center">
      <p class="text-sm opacity-90 mb-2">ë³´ìœ  í¬ì¸íŠ¸</p>
      <h2 class="text-5xl font-bold mb-2" id="myPoints">0 P</h2>
      <p class="text-xs opacity-75">ì²´í—˜í•˜ê³  ì¼í•˜ë©´ì„œ í¬ì¸íŠ¸ë¥¼ ëª¨ì•„ë³´ì„¸ìš”!</p>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
    <div class="flex space-x-2 mb-6 overflow-x-auto pb-2">
      <button onclick="filterCategory('all')" 
              class="px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-orange-500 text-white"
              id="filter-all">
        ì „ì²´
      </button>
      <button onclick="filterCategory('ì¹´í˜')" 
              class="px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-white text-gray-700"
              id="filter-ì¹´í˜">
        â˜• ì¹´í˜
      </button>
      <button onclick="filterCategory('í¸ì˜ì ')" 
              class="px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-white text-gray-700"
              id="filter-í¸ì˜ì ">
        ğŸª í¸ì˜ì 
      </button>
      <button onclick="filterCategory('ë¬¸í™”')" 
              class="px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-white text-gray-700"
              id="filter-ë¬¸í™”">
        ğŸ¬ ë¬¸í™”
      </button>
      <button onclick="filterCategory('ìŒì‹')" 
              class="px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-white text-gray-700"
              id="filter-ìŒì‹">
        ğŸ— ìŒì‹
      </button>
    </div>

    <!-- ìƒí’ˆ ê·¸ë¦¬ë“œ -->
    <div class="grid grid-cols-2 gap-4 mb-8" id="productGrid">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <!-- ìµœê·¼ êµí™˜ ë‚´ì—­ -->
    <div id="historySection" class="bg-white rounded-2xl shadow-sm p-4 hidden mb-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold">ìµœê·¼ êµí™˜ ë‚´ì—­</h3>
        <button onclick="clearHistory()" class="text-xs text-gray-500 hover:text-red-500">
          ì „ì²´ ì‚­ì œ
        </button>
      </div>
      <div class="space-y-3" id="historyList">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4">
      <div class="max-w-md mx-auto flex justify-around">
        <a href="/" class="flex flex-col items-center text-gray-500 hover:text-orange-500">
          <span class="text-2xl mb-1">ğŸ </span>
          <span class="text-xs">í™ˆ</span>
        </a>
        <a href="/jobs.html" class="flex flex-col items-center text-gray-500 hover:text-orange-500">
          <span class="text-2xl mb-1">ğŸ“</span>
          <span class="text-xs">ë‚´ì£¼ë³€</span>
        </a>
        <a href="/community.html" class="flex flex-col items-center text-gray-500 hover:text-orange-500">
          <span class="text-2xl mb-1">ğŸ’¬</span>
          <span class="text-xs">ì»¤ë®¤ë‹ˆí‹°</span>
        </a>
        <a href="/store.html" class="flex flex-col items-center text-orange-500">
          <span class="text-2xl mb-1">ğŸ</span>
          <span class="text-xs font-bold">ìŠ¤í† ì–´</span>
        </a>
      </div>
    </div>
  </div>

  <!-- êµ¬ë§¤ í™•ì¸ ëª¨ë‹¬ -->
  <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl max-w-sm w-full p-6 slide-up">
      <div class="text-center">
        <div class="text-6xl mb-4" id="modalIcon">â˜•</div>
        <h3 class="text-lg font-bold mb-2" id="modalTitle">ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸</h3>
        <div class="bg-gray-100 p-4 rounded-lg mb-4">
          <div class="text-sm text-gray-600 mb-1">ì°¨ê° í¬ì¸íŠ¸</div>
          <div class="text-2xl font-bold text-orange-500" id="modalPrice">100 P</div>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg mb-4">
          <p class="text-xs text-blue-800">
            ğŸ’¡ êµí™˜ í›„ ì¦‰ì‹œ ì´ë©”ì¼ê³¼ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤
          </p>
        </div>
        <p class="text-gray-600 text-sm mb-6">
          ì •ë§ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
          <span class="text-xs text-red-500">âš ï¸ êµí™˜ í›„ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>
        </p>
        <div class="flex space-x-3">
          <button onclick="closeModal()" 
                  class="flex-1 py-3 border-2 border-gray-200 rounded-lg font-bold hover:bg-gray-100 transition">
            ì·¨ì†Œ
          </button>
          <button onclick="confirmPurchase()" 
                  class="flex-1 py-3 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 shadow-lg transition">
            êµí™˜í•˜ê¸°
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì„±ê³µ ëª¨ë‹¬ -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl max-w-sm w-full p-6 text-center slide-up">
      <div class="text-6xl mb-4">ğŸ‰</div>
      <h3 class="text-xl font-bold mb-4">êµí™˜ ì™„ë£Œ!</h3>
      <p class="text-gray-600 mb-4">
        ê¸°í”„í‹°ì½˜ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
        ë“±ë¡í•˜ì‹  ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
      </p>
      <div class="bg-blue-50 p-4 rounded-lg mb-4 text-sm">
        <p class="text-blue-800">
          ğŸ“§ <strong id="userEmail">user@albi.co.kr</strong><br>
          ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë°œì†¡ ì™„ë£Œ<br>
          <span class="text-xs mt-2 block">ê¸°í”„í‹°ì½˜ ì½”ë“œ: <strong id="giftCode">-</strong></span>
        </p>
      </div>
      <div class="bg-yellow-50 p-3 rounded-lg mb-6 text-xs text-yellow-800">
        â° ìœ íš¨ê¸°ê°„: ë°œê¸‰ì¼ë¡œë¶€í„° 90ì¼
      </div>
      <button onclick="closeSuccessModal()" 
              class="w-full py-3 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition">
        í™•ì¸
      </button>
    </div>
  </div>

  <!-- í¬ì¸íŠ¸ ë¶€ì¡± ëª¨ë‹¬ -->
  <div id="insufficientModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl max-w-sm w-full p-6 text-center slide-up">
      <div class="text-6xl mb-4">ğŸ˜¢</div>
      <h3 class="text-xl font-bold mb-4">í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•´ìš”</h3>
      <div class="bg-gray-100 p-4 rounded-lg mb-4">
        <div class="flex justify-between text-sm mb-2">
          <span class="text-gray-600">í•„ìš” í¬ì¸íŠ¸</span>
          <span class="font-bold" id="needPoints">-</span>
        </div>
        <div class="flex justify-between text-sm mb-2">
          <span class="text-gray-600">ë³´ìœ  í¬ì¸íŠ¸</span>
          <span class="font-bold text-orange-500" id="currentPoints">-</span>
        </div>
        <div class="border-t border-gray-300 mt-2 pt-2">
          <div class="flex justify-between text-sm">
            <span class="text-gray-600">ë¶€ì¡±í•œ í¬ì¸íŠ¸</span>
            <span class="font-bold text-red-500" id="lackPoints">-</span>
          </div>
        </div>
      </div>
      <p class="text-sm text-gray-600 mb-6">
        ğŸ’¡ 1ì‹œê°„ ì²´í—˜ì„ ì™„ë£Œí•˜ë©´<br>
        <strong class="text-orange-600">ìµœëŒ€ 50P</strong>ë¥¼ íšë“í•  ìˆ˜ ìˆì–´ìš”!
      </p>
      <div class="flex space-x-3">
        <button onclick="closeInsufficientModal()" 
                class="flex-1 py-3 border-2 border-gray-200 rounded-lg font-bold hover:bg-gray-100 transition">
          ë‹«ê¸°
        </button>
        <a href="/experience" 
           class="flex-1 py-3 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 text-center transition">
          ì²´í—˜í•˜ëŸ¬ ê°€ê¸°
        </a>
      </div>
    </div>
  </div>

  <script>
    let myPoints = 0;
    let selectedProduct = null;
    let purchaseHistory = [];
    let currentFilter = 'all';

    const products = [
      { id: 1, name: "ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸", icon: "â˜•", price: 100, category: "ì¹´í˜", popular: true },
      { id: 2, name: "GS25 ëª¨ë°”ì¼ìƒí’ˆê¶Œ 5ì²œì›", icon: "ğŸª", price: 100, category: "í¸ì˜ì " },
      { id: 3, name: "CU ëª¨ë°”ì¼ìƒí’ˆê¶Œ 5ì²œì›", icon: "ğŸª", price: 100, category: "í¸ì˜ì " },
      { id: 4, name: "ë°°ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ íŒŒì¸íŠ¸", icon: "ğŸ¦", price: 150, category: "ë””ì €íŠ¸" },
      { id: 5, name: "CGV ì˜í™”ê´€ëŒê¶Œ", icon: "ğŸ¬", price: 200, category: "ë¬¸í™”", popular: true },
      { id: 6, name: "ì¹˜í‚¨ ê¸°í”„í‹°ì½˜", icon: "ğŸ—", price: 300, category: "ìŒì‹" },
      { id: 7, name: "ì¹´ì¹´ì˜¤ ì´ëª¨í‹°ì½˜", icon: "ğŸ’¬", price: 50, category: "ë””ì§€í„¸" },
      { id: 8, name: "ì˜¬ë¦¬ë¸Œì˜ 1ë§Œì›ê¶Œ", icon: "ğŸ’„", price: 200, category: "ë·°í‹°" },
      { id: 9, name: "í”¼ì ê¸°í”„í‹°ì½˜", icon: "ğŸ•", price: 300, category: "ìŒì‹" }
    ];

    // ì´ˆê¸°í™”
    function init() {
      loadPoints();
      loadHistory();
      renderProducts();
      renderHistory();
    }

    // í¬ì¸íŠ¸ ë¡œë“œ
    function loadPoints() {
      myPoints = parseInt(localStorage.getItem('albi_points') || '0');
      document.getElementById('myPoints').textContent = `${myPoints.toLocaleString()} P`;
    }

    // íˆìŠ¤í† ë¦¬ ë¡œë“œ
    function loadHistory() {
      const saved = localStorage.getItem('albi_purchase_history');
      if (saved) {
        purchaseHistory = JSON.parse(saved);
      }
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function filterCategory(category) {
      currentFilter = category;
      
      // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      document.querySelectorAll('[id^="filter-"]').forEach(btn => {
        btn.className = 'px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-white text-gray-700';
      });
      document.getElementById(`filter-${category}`).className = 
        'px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap bg-orange-500 text-white';
      
      renderProducts();
    }

    // ìƒí’ˆ ë Œë”ë§
    function renderProducts() {
      const grid = document.getElementById('productGrid');
      const filteredProducts = currentFilter === 'all' 
        ? products 
        : products.filter(p => p.category === currentFilter);

      grid.innerHTML = filteredProducts.map(product => {
        const canAfford = myPoints >= product.price;
        return `
          <div class="bg-white rounded-2xl shadow-sm p-4 relative ${canAfford ? 'hover:shadow-md cursor-pointer' : 'opacity-60'} transition">
            ${product.popular ? '<div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold z-10">ì¸ê¸°</div>' : ''}
            <div class="text-center">
              <div class="text-5xl mb-3">${product.icon}</div>
              <h3 class="font-bold text-sm mb-1 leading-tight h-10 flex items-center justify-center">${product.name}</h3>
              <div class="mb-3">
                <span class="text-orange-500 font-bold text-lg">${product.price} P</span>
              </div>
              <button onclick="openPurchaseModal(${product.id})" ${!canAfford ? 'disabled' : ''}
                      class="w-full py-2 rounded-lg font-bold text-sm transition ${
                        canAfford 
                          ? 'bg-orange-100 text-orange-600 hover:bg-orange-200' 
                          : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                      }">
                ${canAfford ? 'êµí™˜í•˜ê¸°' : 'í¬ì¸íŠ¸ ë¶€ì¡±'}
              </button>
            </div>
          </div>
        `;
      }).join('');

      if (filteredProducts.length === 0) {
        grid.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-500">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>';
      }
    }

    // íˆìŠ¤í† ë¦¬ ë Œë”ë§
    function renderHistory() {
      if (purchaseHistory.length === 0) {
        document.getElementById('historySection').classList.add('hidden');
        return;
      }

      document.getElementById('historySection').classList.remove('hidden');
      const list = document.getElementById('historyList');
      list.innerHTML = purchaseHistory.slice(0, 5).map(item => `
        <div class="flex items-center justify-between text-sm border-b border-gray-100 pb-2">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">${item.icon}</div>
            <div>
              <div class="font-bold">${item.name}</div>
              <div class="text-xs text-gray-500">${new Date(item.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
            </div>
          </div>
          <div class="text-orange-500 font-bold">-${item.price}P</div>
        </div>
      `).join('');
    }

    // íˆìŠ¤í† ë¦¬ ì‚­ì œ
    function clearHistory() {
      if (confirm('êµí™˜ ë‚´ì—­ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        purchaseHistory = [];
        localStorage.setItem('albi_purchase_history', JSON.stringify(purchaseHistory));
        renderHistory();
      }
    }

    // êµ¬ë§¤ ëª¨ë‹¬ ì—´ê¸°
    function openPurchaseModal(productId) {
      selectedProduct = products.find(p => p.id === productId);
      if (!selectedProduct) return;

      // í¬ì¸íŠ¸ ë¶€ì¡± ì²´í¬
      if (myPoints < selectedProduct.price) {
        showInsufficientModal(selectedProduct.price);
        return;
      }

      document.getElementById('modalIcon').textContent = selectedProduct.icon;
      document.getElementById('modalTitle').textContent = selectedProduct.name;
      document.getElementById('modalPrice').textContent = `${selectedProduct.price} P`;
      document.getElementById('purchaseModal').classList.remove('hidden');
      document.getElementById('purchaseModal').classList.add('flex');
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal() {
      document.getElementById('purchaseModal').classList.add('hidden');
      document.getElementById('purchaseModal').classList.remove('flex');
      selectedProduct = null;
    }

    // í¬ì¸íŠ¸ ë¶€ì¡± ëª¨ë‹¬ í‘œì‹œ
    function showInsufficientModal(requiredPoints) {
      document.getElementById('needPoints').textContent = `${requiredPoints} P`;
      document.getElementById('currentPoints').textContent = `${myPoints} P`;
      document.getElementById('lackPoints').textContent = `${requiredPoints - myPoints} P`;
      document.getElementById('insufficientModal').classList.remove('hidden');
      document.getElementById('insufficientModal').classList.add('flex');
    }

    // í¬ì¸íŠ¸ ë¶€ì¡± ëª¨ë‹¬ ë‹«ê¸°
    function closeInsufficientModal() {
      document.getElementById('insufficientModal').classList.add('hidden');
      document.getElementById('insufficientModal').classList.remove('flex');
    }

    // êµ¬ë§¤ í™•ì¸
    function confirmPurchase() {
      if (!selectedProduct) return;

      if (myPoints < selectedProduct.price) {
        alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ì²´í—˜ì„ í†µí•´ í¬ì¸íŠ¸ë¥¼ ëª¨ì•„ë³´ì„¸ìš”.");
        closeModal();
        return;
      }

      // í¬ì¸íŠ¸ ì°¨ê°
      myPoints -= selectedProduct.price;
      localStorage.setItem('albi_points', myPoints.toString());

      // êµ¬ë§¤ ë‚´ì—­ ì¶”ê°€
      const giftCode = generateGiftCode();
      const purchase = {
        id: Date.now().toString(),
        name: selectedProduct.name,
        icon: selectedProduct.icon,
        price: selectedProduct.price,
        date: new Date().toISOString(),
        giftCode: giftCode
      };

      purchaseHistory.unshift(purchase);
      if (purchaseHistory.length > 20) {
        purchaseHistory = purchaseHistory.slice(0, 20);
      }
      localStorage.setItem('albi_purchase_history', JSON.stringify(purchaseHistory));

      closeModal();
      showSuccessModal(purchase);
      
      // í™”ë©´ ì—…ë°ì´íŠ¸
      loadPoints();
      renderProducts();
      renderHistory();

      // ì½˜í˜í‹° íš¨ê³¼
      createConfetti();
    }

    // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
    function showSuccessModal(purchase) {
      document.getElementById('giftCode').textContent = purchase.giftCode;
      document.getElementById('userEmail').textContent = localStorage.getItem('albi_user_email') || 'user@albi.co.kr';
      document.getElementById('successModal').classList.remove('hidden');
      document.getElementById('successModal').classList.add('flex');
    }

    // ì„±ê³µ ëª¨ë‹¬ ë‹«ê¸°
    function closeSuccessModal() {
      document.getElementById('successModal').classList.add('hidden');
      document.getElementById('successModal').classList.remove('flex');
    }

    // ê¸°í”„íŠ¸ ì½”ë“œ ìƒì„±
    function generateGiftCode() {
      return 'ALBI-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    }

    // ì½˜í˜í‹° íš¨ê³¼
    function createConfetti() {
      const colors = ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'â­', 'ğŸ’«'];
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.textContent = colors[Math.floor(Math.random() * colors.length)];
          confetti.className = 'confetti fixed text-2xl';
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = '0px';
          confetti.style.zIndex = '9999';
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 2000);
        }, i * 100);
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.onload = init;
  </script>
</body>
</html>
