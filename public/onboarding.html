<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•Œë¹„ì™€ í•¨ê»˜ ì‹œì‘í•˜ê¸° - ì•Œë¹„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .bounce-animation {
      animation: bounce 2s infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-orange-400 via-orange-500 to-red-500 min-h-screen flex flex-col">
  <!-- í—¤ë” -->
  <div class="bg-white/10 backdrop-blur-sm p-4 flex items-center justify-between">
    <div class="flex items-center space-x-3">
      <div class="text-4xl bounce-animation">ğŸœ</div>
      <div class="text-white">
        <h1 class="text-xl font-bold">ì•Œë¹„ì™€ í•¨ê»˜ ì‹œì‘í•˜ê¸°</h1>
        <p class="text-sm opacity-90">AI ë©´ì ‘ê´€ì´ ë„ì™€ë“œë¦´ê²Œìš”</p>
      </div>
    </div>
    <button onclick="skipOnboarding()" class="text-white/70 hover:text-white text-sm">
      ê±´ë„ˆë›°ê¸° â†’
    </button>
  </div>

  <!-- ì§„í–‰ ìƒíƒœ ë°” -->
  <div class="bg-white/10 backdrop-blur-sm px-4 py-2">
    <div class="max-w-md mx-auto">
      <div class="flex items-center justify-between text-white text-xs mb-2">
        <span>ì§„í–‰ ìƒí™©</span>
        <span id="progressText">0/5</span>
      </div>
      <div class="w-full bg-white/20 rounded-full h-2">
        <div id="progressBar" class="bg-white rounded-full h-2 transition-all duration-500" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <!-- ì±„íŒ… ì˜ì—­ -->
  <div class="flex-1 overflow-y-auto p-4">
    <div class="max-w-md mx-auto space-y-4" id="chatMessages">
      <!-- ì´ˆê¸° ë©”ì‹œì§€ -->
      <div class="flex items-start space-x-3 message-fade-in">
        <div class="w-10 h-10 rounded-full bg-white text-orange-500 flex items-center justify-center flex-shrink-0">
          ğŸœ
        </div>
        <div class="bg-white text-gray-800 p-4 rounded-2xl rounded-tl-none shadow-lg max-w-[80%]">
          <div>ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì•Œë¹„ì˜ˆìš” ğŸœ<br><br>ì•Œë°”í•˜ëŠ” <strong>ë²Œê°œë¯¸</strong>ì²˜ëŸ¼ ì—´ì‹¬íˆ ì—¬ëŸ¬ë¶„ì˜ ì¼ìë¦¬ ì°¾ê¸°ë¥¼ ë„ì™€ë“œë¦´ê²Œìš”!<br><br>ë¨¼ì € <strong class="text-orange-600">ì„±í•¨</strong>ì„ ì•Œë ¤ì£¼ì„¸ìš”!</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì…ë ¥ ì˜ì—­ -->
  <div class="bg-white/10 backdrop-blur-sm p-4">
    <div class="max-w-md mx-auto">
      <div id="inputArea" class="flex space-x-3">
        <input
          type="text"
          id="messageInput"
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
          class="flex-1 bg-white/20 backdrop-blur-sm text-white placeholder-white/70 border-2 border-white/30 rounded-full px-6 py-3 focus:outline-none focus:border-white transition"
          autocomplete="off"
        />
        <button
          id="sendButton"
          onclick="sendMessage()"
          class="bg-white text-orange-500 px-6 py-3 rounded-full hover:bg-gray-100 transition shadow-lg font-bold"
        >
          ì „ì†¡
        </button>
      </div>
      
      <!-- ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ (ë™ì  ìƒì„±) -->
      <div id="quickReplies" class="mt-3 flex flex-wrap gap-2 hidden"></div>
      
      <!-- ì™„ë£Œ ë²„íŠ¼ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
      <button
        id="completeButton"
        onclick="completeOnboarding()"
        class="w-full bg-white text-orange-500 py-4 rounded-full font-bold text-lg hover:bg-gray-100 transition shadow-lg mt-4 hidden"
      >
        íšŒì›ê°€ì… ì™„ë£Œí•˜ê³  20P ë°›ê¸° ğŸ‰
      </button>
    </div>
  </div>

  <script>
    let currentStep = 0;
    let userInfo = {
      name: '',
      userType: '',
      interests: '',
      experience: '',
      location: ''
    };
    let isLoading = false;

    const onboardingFlow = [
      {
        step: 0,
        expectsInput: 'name',
        quickReplies: null,
        nextMessage: (name) => `ë°˜ê°€ì›Œìš” <strong class="text-orange-600">${name}ë‹˜</strong>! ğŸ‰<br><br>ì•Œë¹„ëŠ” <strong>1ì‹œê°„ ì§ì¥ì²´í—˜ ì„œë¹„ìŠ¤</strong>ì˜ˆìš”. ì‹¤ì œë¡œ ì¼í•˜ì§€ ì•Šê³  ê´€ì°°ë§Œ í•´ì„œ ì§ì¥ì„ ë¯¸ë¦¬ ì²´í—˜í•  ìˆ˜ ìˆì–´ìš”.<br><br>${name}ë‹˜ì€ ì¼ìë¦¬ë¥¼ ì°¾ê³  ê³„ì‹ ê°€ìš”, ì•„ë‹ˆë©´ ì§ì›ì„ êµ¬í•˜ê³  ê³„ì‹ ê°€ìš”?`
      },
      {
        step: 1,
        expectsInput: 'userType',
        quickReplies: [
          { text: 'ğŸ” ì¼ìë¦¬ ì°¾ê¸° (êµ¬ì§ì)', value: 'jobseeker' },
          { text: 'ğŸ‘” ì§ì› êµ¬í•˜ê¸° (êµ¬ì¸ì)', value: 'employer' }
        ],
        nextMessage: {
          jobseeker: "ì¢‹ì•„ìš”! ì–´ë–¤ ì¢…ë¥˜ì˜ ì•Œë°”ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”? ğŸ¤”<br><br>ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!",
          employer: "ì‚¬ì¥ë‹˜ì´ì‹œêµ°ìš”! ğŸ‘”<br><br>ì–´ë–¤ ì—…ì¢…ì´ì‹ ê°€ìš”?<br><br>ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!"
        }
      },
      {
        step: 2,
        expectsInput: 'interests',
        quickReplies: null,
        nextMessage: {
          jobseeker: "í›Œë¥­í•œ ì„ íƒì´ì—ìš”! ğŸ˜Š<br><br>í˜¹ì‹œ ê´€ë ¨ ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?",
          employer: "ë©‹ì§„ ì‚¬ì—…ì´ì‹œë„¤ìš”! ğŸ’ª<br><br>ì–´ë–¤ ì§ì›ë¶„ì„ ì°¾ê³  ê³„ì‹ ê°€ìš”?"
        }
      },
      {
        step: 3,
        expectsInput: 'experience',
        quickReplies: null,
        nextMessage: "ë§ˆì§€ë§‰ ì§ˆë¬¸ì´ì—ìš”! ğŸ¯<br><br>ì–´ëŠ ì§€ì—­ì—ì„œ ì¼í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?<br>(ë˜ëŠ” ì‚¬ì—…ì¥ì´ ì–´ë””ì— ìˆìœ¼ì‹ ê°€ìš”?)<br><br>ì˜ˆ: í™ëŒ€, ê°•ë‚¨, ì‹ ì´Œ, ê±´ëŒ€ ë“±"
      },
      {
        step: 4,
        expectsInput: 'location',
        quickReplies: null,
        isComplete: true
      }
    ];

    function updateProgress() {
      const progress = ((currentStep + 1) / onboardingFlow.length) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
      document.getElementById('progressText').textContent = `${currentStep + 1}/${onboardingFlow.length}`;
    }

    function addMessage(type, content, isHTML = false) {
      const messagesDiv = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message-fade-in';
      
      if (type === 'user') {
        messageDiv.className += ' flex items-start space-x-3 flex-row-reverse space-x-reverse';
        messageDiv.innerHTML = `
          <div class="w-10 h-10 rounded-full bg-white/20 text-white flex items-center justify-center flex-shrink-0">
            ğŸ‘¤
          </div>
          <div class="bg-white/20 backdrop-blur-sm text-white p-4 rounded-2xl rounded-tr-none shadow-lg max-w-[80%]">
            <div>${content}</div>
          </div>
        `;
      } else {
        messageDiv.className += ' flex items-start space-x-3';
        const formattedContent = isHTML ? content : content.replace(/\n/g, '<br>');
        messageDiv.innerHTML = `
          <div class="w-10 h-10 rounded-full bg-white text-orange-500 flex items-center justify-center flex-shrink-0">
            ğŸœ
          </div>
          <div class="bg-white text-gray-800 p-4 rounded-2xl rounded-tl-none shadow-lg max-w-[80%]">
            <div>${formattedContent}</div>
          </div>
        `;
      }
      
      messagesDiv.appendChild(messageDiv);
      
      // ìŠ¤í¬ë¡¤ì„ ë¶€ë“œëŸ½ê²Œ í•˜ë‹¨ìœ¼ë¡œ
      setTimeout(() => {
        messagesDiv.scrollTo({
          top: messagesDiv.scrollHeight,
          behavior: 'smooth'
        });
      }, 100);
    }

    function showLoading() {
      const messagesDiv = document.getElementById('chatMessages');
      const loadingDiv = document.createElement('div');
      loadingDiv.id = 'loading';
      loadingDiv.className = 'flex items-start space-x-3 message-fade-in';
      loadingDiv.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-white text-orange-500 flex items-center justify-center flex-shrink-0">
          ğŸœ
        </div>
        <div class="bg-white text-gray-800 p-4 rounded-2xl rounded-tl-none shadow-lg">
          <div class="flex items-center space-x-2">
            <div class="animate-spin">â³</div>
            <span class="text-gray-600">ì•Œë¹„ê°€ ìƒê° ì¤‘...</span>
          </div>
        </div>
      `;
      messagesDiv.appendChild(loadingDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function hideLoading() {
      const loading = document.getElementById('loading');
      if (loading) loading.remove();
    }

    function showQuickReplies(replies) {
      const quickRepliesDiv = document.getElementById('quickReplies');
      
      if (!replies || replies.length === 0) {
        quickRepliesDiv.classList.add('hidden');
        return;
      }

      quickRepliesDiv.innerHTML = replies.map(reply => `
        <button
          onclick="selectQuickReply('${reply.value}', '${reply.text.replace(/'/g, "\\'")}')"
          class="bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm hover:bg-white/30 transition border border-white/30"
        >
          ${reply.text}
        </button>
      `).join('');
      
      quickRepliesDiv.classList.remove('hidden');
    }

    function hideQuickReplies() {
      const quickRepliesDiv = document.getElementById('quickReplies');
      quickRepliesDiv.classList.add('hidden');
      quickRepliesDiv.innerHTML = '';
    }

    function selectQuickReply(value, text) {
      document.getElementById('messageInput').value = value;
      hideQuickReplies();
      sendMessage();
    }

    async function sendMessage() {
      if (isLoading) return;
      
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      if (!message) return;
      
      addMessage('user', message);
      input.value = '';
      isLoading = true;
      hideQuickReplies();
      
      showLoading();
      
      // ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
      const currentFlow = onboardingFlow[currentStep];
      
      // ì •ë³´ ì €ì¥
      switch (currentFlow.expectsInput) {
        case 'name':
          userInfo.name = message;
          break;
        case 'userType':
          if (message === 'jobseeker' || message.includes('êµ¬ì§') || message.includes('ì¼ìë¦¬')) {
            userInfo.userType = 'jobseeker';
          } else if (message === 'employer' || message.includes('êµ¬ì¸') || message.includes('ì§ì›')) {
            userInfo.userType = 'employer';
          } else {
            userInfo.userType = 'jobseeker'; // ê¸°ë³¸ê°’
          }
          break;
        case 'interests':
          userInfo.interests = message;
          break;
        case 'experience':
          userInfo.experience = message;
          break;
        case 'location':
          userInfo.location = message;
          break;
      }
      
      // ë‹¤ìŒ ë©”ì‹œì§€ ìƒì„±
      setTimeout(() => {
        hideLoading();
        
        if (currentFlow.isComplete) {
          // ì˜¨ë³´ë”© ì™„ë£Œ
          const userTypeText = userInfo.userType === 'jobseeker' ? 'êµ¬ì§ì' : 'êµ¬ì¸ì';
          const actionText = userInfo.userType === 'jobseeker' ? 'ë§ì¶¤ ì¼ìë¦¬ë¥¼ ì¶”ì²œ' : 'ì í•©í•œ ì¸ì¬ë¥¼ ì¶”ì²œ';
          
          const completionMessage = `ì™„ë²½í•´ìš”! ğŸ‰<br><br><strong class="text-orange-600">${userInfo.name}ë‹˜</strong>ì˜ ì •ë³´ë¥¼ ì •ë¦¬í•´ë“œë¦´ê²Œìš”:<br><br>ğŸ‘¤ <strong>${userTypeText}</strong><br>ğŸ¯ ê´€ì‹¬ë¶„ì•¼: ${userInfo.interests}<br>ğŸ’¼ ê²½í—˜: ${userInfo.experience}<br>ğŸ“ ì§€ì—­: ${userInfo.location}<br><br>ì´ì œ ${actionText}í•´ë“œë¦´ê²Œìš”!<br><br><strong class="text-orange-600">ê°€ì… ë³´ë„ˆìŠ¤ 20P</strong>ë¥¼ ë“œë¦½ë‹ˆë‹¤! ğŸ`;
          
          addMessage('bot', completionMessage, true);
          
          // ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ
          document.getElementById('inputArea').classList.add('hidden');
          document.getElementById('completeButton').classList.remove('hidden');
        } else {
          // ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
          currentStep++;
          updateProgress();
          
          const nextFlow = onboardingFlow[currentStep];
          let botMessage = '';
          
          if (typeof nextFlow.nextMessage === 'string') {
            botMessage = nextFlow.nextMessage;
          } else if (typeof nextFlow.nextMessage === 'function') {
            botMessage = nextFlow.nextMessage(userInfo.name);
          } else if (typeof nextFlow.nextMessage === 'object') {
            botMessage = nextFlow.nextMessage[userInfo.userType || 'jobseeker'];
          }
          
          addMessage('bot', botMessage, true);
          
          // ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ í‘œì‹œ
          if (nextFlow.quickReplies) {
            showQuickReplies(nextFlow.quickReplies);
          }
        }
        
        isLoading = false;
        document.getElementById('messageInput').focus();
      }, 1500);
    }

    function completeOnboarding() {
      // ì‚¬ìš©ì ì •ë³´ ì €ì¥
      localStorage.setItem('albi_user_info', JSON.stringify(userInfo));
      localStorage.setItem('albi_user_email', userInfo.name + '@albi.co.kr'); // ì„ì‹œ ì´ë©”ì¼
      
      // ê°€ì… ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸
      const currentPoints = parseInt(localStorage.getItem('albi_points') || '0');
      localStorage.setItem('albi_points', (currentPoints + 20).toString());
      
      // ê°€ì… ì™„ë£Œ í‘œì‹œ
      localStorage.setItem('albi_onboarding_completed', 'true');
      
      alert(`ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤, ${userInfo.name}ë‹˜!\n\níšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê°€ì… ë³´ë„ˆìŠ¤ 20 ì•Œë¹„í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      
      // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
      window.location.href = '/';
    }

    function skipOnboarding() {
      if (confirm('ì˜¨ë³´ë”©ì„ ê±´ë„ˆë›°ì‹œê² ìŠµë‹ˆê¹Œ?\n\në‚˜ì¤‘ì— í”„ë¡œí•„ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
        localStorage.setItem('albi_onboarding_completed', 'true');
        window.location.href = '/';
      }
    }

    // Enter í‚¤ ì´ë²¤íŠ¸
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ
    window.onload = function() {
      // ì´ë¯¸ ì˜¨ë³´ë”© ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸
      if (localStorage.getItem('albi_onboarding_completed')) {
        if (confirm('ì´ë¯¸ íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          window.location.href = '/';
          return;
        }
      }
      
      // í¬ì»¤ìŠ¤
      document.getElementById('messageInput').focus();
      
      // ì´ˆê¸° ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateProgress();
    };

    // í˜ì´ì§€ ì´íƒˆ ë°©ì§€
    window.addEventListener('beforeunload', function(e) {
      if (currentStep > 0 && currentStep < onboardingFlow.length) {
        e.preventDefault();
        e.returnValue = '';
        return 'ì˜¨ë³´ë”©ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      }
    });
  </script>
</body>
</html>
