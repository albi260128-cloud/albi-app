<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•Œë¹„ ì»¤ë®¤ë‹ˆí‹° - ì•Œë¹„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .post-card { transition: all 0.2s ease; }
    .post-card:active { transform: scale(0.98); }
  </style>
</head>
<body class="bg-gray-50 pb-20">
  <!-- ìƒë‹¨ í—¤ë” -->
  <header class="bg-white sticky top-0 z-50 shadow-sm">
    <div class="px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <span class="text-2xl">ğŸ’¬</span>
        <h1 class="font-bold text-xl">ì•Œë¹„ í†¡í†¡</h1>
      </div>
      <a href="/write-post.html" class="bg-orange-500 text-white px-4 py-2 rounded-full text-sm font-bold hover:bg-orange-600 flex items-center space-x-1">
        <span>âœï¸</span>
        <span>ê¸€ì“°ê¸°</span>
      </a>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
    <div class="flex overflow-x-auto px-4 py-2 space-x-2 border-b">
      <button onclick="filterCategory('all')" data-category="all"
              class="category-tab px-4 py-2 rounded-full text-sm font-bold bg-orange-500 text-white whitespace-nowrap">
        ì „ì²´
      </button>
      <button onclick="filterCategory('free')" data-category="free"
              class="category-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap">
        ğŸ—£ï¸ ììœ 
      </button>
      <button onclick="filterCategory('review')" data-category="review"
              class="category-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap">
        ğŸ“ í›„ê¸°
      </button>
      <button onclick="filterCategory('question')" data-category="question"
              class="category-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap">
        â“ ì§ˆë¬¸
      </button>
      <button onclick="filterCategory('tip')" data-category="tip"
              class="category-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap">
        ğŸ’¡ ê¿€íŒ
      </button>
    </div>

    <!-- ì •ë ¬ ì˜µì…˜ -->
    <div class="px-4 py-2 bg-gray-50 border-b">
      <select id="sortSelect" onchange="loadPosts()" 
              class="text-sm border border-gray-200 rounded-lg px-3 py-1 focus:outline-none focus:border-orange-500">
        <option value="latest">ìµœì‹ ìˆœ</option>
        <option value="popular">ì¸ê¸°ìˆœ</option>
        <option value="views">ì¡°íšŒìˆœ</option>
      </select>
    </div>
  </header>

  <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
  <main class="p-4">
    <div id="loading" class="text-center py-12">
      <div class="text-4xl mb-4 animate-bounce">ğŸœ</div>
      <p class="text-gray-600">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div id="postsList" class="space-y-3">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <div id="loadMore" class="text-center py-6 hidden">
      <button onclick="loadMorePosts()" 
              class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300">
        ë” ë³´ê¸°
      </button>
    </div>

    <div id="noResults" class="hidden text-center py-12">
      <div class="text-6xl mb-4">ğŸ“</div>
      <h3 class="text-xl font-bold mb-2">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ì–´ìš”</h3>
      <p class="text-gray-600 mb-6">ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
      <a href="/write-post.html" class="inline-block bg-orange-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-orange-600">
        ê¸€ì“°ê¸°
      </a>
    </div>
  </main>

  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="fixed bottom-0 w-full bg-white border-t flex justify-around py-3 z-50">
    <a href="/" class="flex flex-col items-center space-y-1 text-gray-500">
      <span class="text-xl">ğŸ </span>
      <span class="text-xs">í™ˆ</span>
    </a>
    <a href="/jobs.html" class="flex flex-col items-center space-y-1 text-gray-500">
      <span class="text-xl">ğŸ“</span>
      <span class="text-xs">ë‚´ì£¼ë³€</span>
    </a>
    <a href="/community.html" class="flex flex-col items-center space-y-1 text-orange-500 font-bold">
      <span class="text-xl">ğŸ’¬</span>
      <span class="text-xs">ì»¤ë®¤ë‹ˆí‹°</span>
    </a>
    <a href="/store.html" class="flex flex-col items-center space-y-1 text-gray-500">
      <span class="text-xl">ğŸ</span>
      <span class="text-xs">ìŠ¤í† ì–´</span>
    </a>
  </nav>

  <script>
    let currentCategory = 'all';
    let currentPage = 1;
    let isLoading = false;
    let hasMore = true;

    const categoryIcons = {
      free: 'ğŸ—£ï¸',
      review: 'ğŸ“',
      question: 'â“',
      tip: 'ğŸ’¡'
    };

    const categoryNames = {
      free: 'ììœ ',
      review: 'í›„ê¸°',
      question: 'ì§ˆë¬¸',
      tip: 'ê¿€íŒ'
    };

    // ì´ˆê¸°í™”
    window.onload = function() {
      loadPosts();
    };

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function filterCategory(category) {
      currentCategory = category;
      currentPage = 1;
      hasMore = true;
      document.getElementById('postsList').innerHTML = '';
      
      // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.category-tab').forEach(tab => {
        if (tab.dataset.category === category) {
          tab.className = 'category-tab px-4 py-2 rounded-full text-sm font-bold bg-orange-500 text-white whitespace-nowrap';
        } else {
          tab.className = 'category-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap';
        }
      });

      loadPosts();
    }

    // ê²Œì‹œê¸€ ë¡œë“œ
    async function loadPosts() {
      if (isLoading) return;
      
      isLoading = true;
      document.getElementById('loading').classList.remove('hidden');

      try {
        const sort = document.getElementById('sortSelect').value;
        const params = new URLSearchParams({
          category: currentCategory,
          sort,
          page: currentPage.toString(),
          limit: '20'
        });

        const response = await fetch(`/api/community/posts?${params}`);
        const data = await response.json();

        if (data.success) {
          renderPosts(data.data.posts, currentPage === 1);
          hasMore = data.data.hasMore;
          
          if (hasMore) {
            document.getElementById('loadMore').classList.remove('hidden');
          } else {
            document.getElementById('loadMore').classList.add('hidden');
          }

          if (data.data.posts.length === 0 && currentPage === 1) {
            document.getElementById('noResults').classList.remove('hidden');
          } else {
            document.getElementById('noResults').classList.add('hidden');
          }
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        console.error('Load posts error:', error);
        alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      } finally {
        isLoading = false;
        document.getElementById('loading').classList.add('hidden');
      }
    }

    // ê²Œì‹œê¸€ ë Œë”ë§
    function renderPosts(posts, clear = false) {
      const container = document.getElementById('postsList');
      
      if (clear) {
        container.innerHTML = '';
      }

      posts.forEach(post => {
        const postCard = document.createElement('div');
        postCard.className = 'post-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md cursor-pointer transition';
        postCard.onclick = () => viewPost(post.id);

        postCard.innerHTML = `
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center space-x-2">
              <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full font-bold">
                ${categoryIcons[post.category]} ${categoryNames[post.category]}
              </span>
              ${post.is_featured ? '<span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-bold">ğŸ”¥ ì¸ê¸°</span>' : ''}
            </div>
            <span class="text-xs text-gray-500">${post.timeAgo}</span>
          </div>
          
          <h3 class="font-bold text-gray-900 mb-2 line-clamp-2">${escapeHtml(post.title)}</h3>
          <p class="text-sm text-gray-600 mb-3 line-clamp-2">${escapeHtml(post.preview)}</p>
          
          <div class="flex items-center justify-between text-xs text-gray-500">
            <div class="flex items-center space-x-1">
              <span class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">ğŸ‘¤</span>
              <span class="font-medium">${escapeHtml(post.author_name)}</span>
            </div>
            <div class="flex items-center space-x-3">
              <span class="flex items-center space-x-1">
                <span>ğŸ‘ï¸</span>
                <span>${post.views}</span>
              </span>
              <span class="flex items-center space-x-1 text-red-500">
                <span>â¤ï¸</span>
                <span>${post.likes_count}</span>
              </span>
              <span class="flex items-center space-x-1 text-blue-500">
                <span>ğŸ’¬</span>
                <span>${post.comments_count}</span>
              </span>
            </div>
          </div>
        `;

        container.appendChild(postCard);
      });
    }

    // ë” ë³´ê¸°
    function loadMorePosts() {
      currentPage++;
      loadPosts();
    }

    // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
    function viewPost(postId) {
      window.location.href = `/post-detail.html?id=${postId}`;
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
