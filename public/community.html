<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì»¤ë®¤ë‹ˆí‹° - ì•Œë¹„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
    }
    .post-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .filter-chip {
      transition: all 0.2s;
    }
    .filter-chip.active {
      background: #FF6B35;
      color: white;
      font-weight: 600;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between max-w-1200px">
      <a href="/" class="flex items-center space-x-2">
        <img src="/albi-mascot.svg" alt="ì•Œë¹„" style="width: 32px; height: 32px;">
        <span class="text-2xl font-bold text-orange-500">ì•Œë¹„ ì»¤ë®¤ë‹ˆí‹°</span>
      </a>
      <a href="/write-post.html" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition flex items-center gap-2">
        <i class="fas fa-pencil-alt"></i>
        <span class="hidden sm:inline">ê¸€ì“°ê¸°</span>
      </a>
    </div>
  </nav>

  <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
  <div class="bg-white border-b sticky top-16 z-40">
    <div class="container mx-auto px-4 py-3 max-w-1200px">
      <div class="flex gap-2 overflow-x-auto scrollbar-hide">
        <button onclick="filterCategory('all')" data-category="all" class="filter-chip active px-4 py-2 rounded-full border border-gray-300 text-sm whitespace-nowrap">
          ì „ì²´
        </button>
        <button onclick="filterCategory('free')" data-category="free" class="filter-chip px-4 py-2 rounded-full border border-gray-300 text-sm whitespace-nowrap">
          ğŸ—£ï¸ ììœ 
        </button>
        <button onclick="filterCategory('review')" data-category="review" class="filter-chip px-4 py-2 rounded-full border border-gray-300 text-sm whitespace-nowrap">
          ğŸ“ í›„ê¸°
        </button>
        <button onclick="filterCategory('question')" data-category="question" class="filter-chip px-4 py-2 rounded-full border border-gray-300 text-sm whitespace-nowrap">
          â“ ì§ˆë¬¸
        </button>
        <button onclick="filterCategory('tip')" data-category="tip" class="filter-chip px-4 py-2 rounded-full border border-gray-300 text-sm whitespace-nowrap">
          ğŸ’¡ ê¿€íŒ
        </button>
      </div>
    </div>
  </div>

  <!-- ì •ë ¬ ì˜µì…˜ -->
  <div class="bg-gray-100 border-b">
    <div class="container mx-auto px-4 py-2 max-w-1200px">
      <select id="sortSelect" onchange="loadPosts()" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-orange-500">
        <option value="latest">ìµœì‹ ìˆœ</option>
        <option value="popular">ì¸ê¸°ìˆœ</option>
        <option value="views">ì¡°íšŒìˆœ</option>
      </select>
    </div>
  </div>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <main class="container mx-auto px-4 py-6 max-w-1200px mb-20">
    <!-- ë¡œë”© ìƒíƒœ -->
    <div id="loading" class="text-center py-12">
      <img src="/albi-mascot.svg" alt="ë¡œë”©" class="w-16 h-16 mx-auto mb-4 animate-bounce">
      <p class="text-gray-600">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
    <div id="postsList" class="space-y-4">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
    <div id="loadMore" class="text-center py-6 hidden">
      <button onclick="loadMorePosts()" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-semibold hover:bg-gray-50 transition">
        <i class="fas fa-chevron-down mr-2"></i>
        ë” ë³´ê¸°
      </button>
    </div>

    <!-- ê²Œì‹œê¸€ ì—†ìŒ -->
    <div id="noResults" class="hidden text-center py-12">
      <div class="text-6xl mb-4">ğŸ“</div>
      <h3 class="text-2xl font-bold text-gray-800 mb-2">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ì–´ìš”</h3>
      <p class="text-gray-600 mb-6">ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
      <a href="/write-post.html" class="inline-flex items-center gap-2 px-6 py-3 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
        <i class="fas fa-pencil-alt"></i>
        ê¸€ì“°ê¸°
      </a>
    </div>
  </main>

  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-50 md:hidden">
    <div class="grid grid-cols-4">
      <a href="/" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-home text-xl mb-1"></i>
        <span class="text-xs">í™ˆ</span>
      </a>
      <a href="/jobs" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-briefcase text-xl mb-1"></i>
        <span class="text-xs">ì•Œë°”ì°¾ê¸°</span>
      </a>
      <a href="/community.html" class="flex flex-col items-center py-3 text-orange-500">
        <i class="fas fa-comments text-xl mb-1"></i>
        <span class="text-xs">ì»¤ë®¤ë‹ˆí‹°</span>
      </a>
      <a href="/mypage.html" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-user text-xl mb-1"></i>
        <span class="text-xs">MY</span>
      </a>
    </div>
  </nav>

  <script>
    let currentCategory = 'all';
    let currentPage = 1;
    let isLoading = false;
    let hasMore = true;

    const categoryIcons = {
      free: 'ğŸ—£ï¸',
      review: 'ğŸ“',
      question: 'â“',
      tip: 'ğŸ’¡'
    };

    const categoryNames = {
      free: 'ììœ ',
      review: 'í›„ê¸°',
      question: 'ì§ˆë¬¸',
      tip: 'ê¿€íŒ'
    };

    // ì´ˆê¸°í™”
    window.onload = function() {
      loadPosts();
    };

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function filterCategory(category) {
      currentCategory = category;
      currentPage = 1;
      hasMore = true;
      document.getElementById('postsList').innerHTML = '';
      
      // í•„í„° ì¹© í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.filter-chip').forEach(chip => {
        if (chip.dataset.category === category) {
          chip.classList.add('active');
        } else {
          chip.classList.remove('active');
        }
      });

      loadPosts();
    }

    // ê²Œì‹œê¸€ ë¡œë“œ
    async function loadPosts() {
      if (isLoading) return;
      
      isLoading = true;
      document.getElementById('loading').classList.remove('hidden');

      try {
        const sort = document.getElementById('sortSelect').value;
        const params = new URLSearchParams({
          category: currentCategory,
          sort,
          page: currentPage.toString(),
          limit: '20'
        });

        const response = await fetch(`/api/community/posts?${params}`);
        const data = await response.json();

        if (data.success) {
          renderPosts(data.data.posts, currentPage === 1);
          hasMore = data.data.hasMore;
          
          if (hasMore) {
            document.getElementById('loadMore').classList.remove('hidden');
          } else {
            document.getElementById('loadMore').classList.add('hidden');
          }

          if (data.data.posts.length === 0 && currentPage === 1) {
            document.getElementById('noResults').classList.remove('hidden');
          } else {
            document.getElementById('noResults').classList.add('hidden');
          }
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        console.error('Load posts error:', error);
        // ëª©ì—… ë°ì´í„°ë¡œ ëŒ€ì²´
        renderMockPosts(currentPage === 1);
      } finally {
        isLoading = false;
        document.getElementById('loading').classList.add('hidden');
      }
    }

    // ëª©ì—… ë°ì´í„°ë¡œ ê²Œì‹œê¸€ ë Œë”ë§ (API ì—†ì„ ë•Œ)
    function renderMockPosts(clear = false) {
      const mockPosts = [
        {
          id: 1,
          category: 'review',
          title: 'ìŠ¤íƒ€ë²…ìŠ¤ ì•Œë°” 3ê°œì›” í›„ê¸°ì…ë‹ˆë‹¤',
          preview: 'ì•ˆë…•í•˜ì„¸ìš”~ ìŠ¤íƒ€ë²…ìŠ¤ì—ì„œ 3ê°œì›” ë™ì•ˆ ì¼í•œ í›„ê¸° ë‚¨ê¹ë‹ˆë‹¤. ì²˜ìŒì—ëŠ” í˜ë“¤ì—ˆì§€ë§Œ ì§€ê¸ˆì€...',
          author_name: 'ì•Œë¹„ìœ ì €123',
          timeAgo: '2ì‹œê°„ ì „',
          views: 1234,
          likes_count: 45,
          comments_count: 23,
          is_featured: true
        },
        {
          id: 2,
          category: 'question',
          title: 'í¸ì˜ì  ì•Œë°” ë©´ì ‘ ë•Œ ë­ ë¬¼ì–´ë³´ë‚˜ìš”?',
          preview: 'ë‚´ì¼ í¸ì˜ì  ë©´ì ‘ì¸ë° ì²˜ìŒì´ë¼ ë„ˆë¬´ ë–¨ë ¤ìš”. ë³´í†µ ë­ ë¬¼ì–´ë³´ë‚˜ìš”?',
          author_name: 'ì•Œë°”ì´ˆë³´',
          timeAgo: '5ì‹œê°„ ì „',
          views: 892,
          likes_count: 12,
          comments_count: 18,
          is_featured: false
        },
        {
          id: 3,
          category: 'tip',
          title: 'ì•Œë°”ìƒì´ ê¼­ ì•Œì•„ì•¼ í•  ê·¼ë¡œê¸°ì¤€ë²• 5ê°€ì§€',
          preview: 'ì•Œë°”í•˜ë©´ì„œ ì•Œì•„ë‘ë©´ ìœ ìš©í•œ ê·¼ë¡œê¸°ì¤€ë²• ì •ë¦¬í•´ë´¤ì–´ìš”. 1. ìµœì €ì„ê¸ˆì€...',
          author_name: 'ë²•ì˜ì•Œ',
          timeAgo: '1ì¼ ì „',
          views: 2341,
          likes_count: 156,
          comments_count: 42,
          is_featured: true
        },
        {
          id: 4,
          category: 'free',
          title: 'ì˜¤ëŠ˜ ì²« ì•Œë°” ëë‚¬ì–´ìš”!',
          preview: 'ì˜¤ëŠ˜ ì²« ì•Œë°” ëë‚¬ëŠ”ë° ë„ˆë¬´ ë¿Œë“¯í•˜ë„¤ìš” ã…ã… ì‚¬ì¥ë‹˜ë„ ì¹œì ˆí•˜ì‹œê³ ...',
          author_name: 'ì‹ ì…ì•Œë¹„',
          timeAgo: '1ì¼ ì „',
          views: 456,
          likes_count: 34,
          comments_count: 15,
          is_featured: false
        },
        {
          id: 5,
          category: 'review',
          title: 'ì¹´í˜ ì•Œë°” vs í¸ì˜ì  ì•Œë°” ë¹„êµ',
          preview: 'ë‘˜ ë‹¤ í•´ë´¤ëŠ”ë° í™•ì‹¤íˆ ì°¨ì´ê°€ ìˆë”ë¼êµ¬ìš”. ì œ ê²½í—˜ ê³µìœ í•©ë‹ˆë‹¤...',
          author_name: 'ì•Œë°”ê²½í—˜ì',
          timeAgo: '2ì¼ ì „',
          views: 1567,
          likes_count: 89,
          comments_count: 56,
          is_featured: false
        }
      ];

      renderPosts(mockPosts, clear);
      hasMore = false;
      document.getElementById('loadMore').classList.add('hidden');
    }

    // ê²Œì‹œê¸€ ë Œë”ë§
    function renderPosts(posts, clear = false) {
      const container = document.getElementById('postsList');
      
      if (clear) {
        container.innerHTML = '';
      }

      posts.forEach(post => {
        const postCard = document.createElement('div');
        postCard.className = 'post-card bg-white rounded-lg border border-gray-200 p-5 cursor-pointer transition-all';
        postCard.onclick = () => viewPost(post.id);

        postCard.innerHTML = `
          <div class="flex items-center gap-2 mb-3">
            <span class="px-3 py-1 bg-orange-100 text-orange-600 rounded-full text-xs font-semibold">
              ${categoryIcons[post.category]} ${categoryNames[post.category]}
            </span>
            ${post.is_featured ? '<span class="px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-semibold"><i class="fas fa-fire"></i> ì¸ê¸°</span>' : ''}
            <span class="text-xs text-gray-500 ml-auto">${post.timeAgo}</span>
          </div>
          
          <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">${escapeHtml(post.title)}</h3>
          
          <p class="text-gray-600 text-sm mb-4 line-clamp-2">${escapeHtml(post.preview)}</p>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs">ğŸ‘¤</div>
              <span class="text-sm font-medium text-gray-700">${escapeHtml(post.author_name)}</span>
            </div>
            <div class="flex items-center gap-4 text-sm text-gray-500">
              <span class="flex items-center gap-1">
                <i class="fas fa-eye"></i>
                ${post.views}
              </span>
              <span class="flex items-center gap-1 text-red-500">
                <i class="fas fa-heart"></i>
                ${post.likes_count}
              </span>
              <span class="flex items-center gap-1 text-blue-500">
                <i class="fas fa-comment"></i>
                ${post.comments_count}
              </span>
            </div>
          </div>
        `;

        container.appendChild(postCard);
      });
    }

    // ë” ë³´ê¸°
    function loadMorePosts() {
      currentPage++;
      loadPosts();
    }

    // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
    function viewPost(postId) {
      window.location.href = `/post-detail.html?id=${postId}`;
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
