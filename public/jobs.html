<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•Œë°”ì°¾ê¸° - ì•Œë¹„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Kakao ì§€ë„ API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b69e30d2c21d6db82408ee9a2091d293"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
    }
    #map { 
      width: 100%; 
      height: calc(100vh - 200px); 
    }
    .job-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .filter-chip.active {
      background: #FF6B35;
      color: white;
      border-color: #FF6B35;
    }
    
    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      #map {
        height: calc(100vh - 140px);
      }
      
      .container.mx-auto {
        padding-left: 0.875rem;
        padding-right: 0.875rem;
      }
      
      /* ë„¤ë¹„ê²Œì´ì…˜ */
      nav {
        padding: 0.75rem 1rem;
      }
      
      nav .text-xl {
        font-size: 1rem;
      }
      
      nav .text-xs {
        font-size: 0.625rem;
      }
      
      nav img {
        width: 28px !important;
        height: 28px !important;
      }
      
      /* ê³µê³ ì˜¬ë¦¬ê¸° ë²„íŠ¼ */
      nav a span.hidden.sm\\:inline {
        display: none !important;
      }
      
      nav a.bg-orange-500 {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }
      
      /* íƒ­ ë²„íŠ¼ */
      button.flex-1 {
        font-size: 0.8125rem;
        padding: 0.625rem;
      }
      
      /* í•„í„° ì„¹ì…˜ */
      .flex.gap-2.mb-4 {
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }
      
      /* í•„í„° ì¹© */
      .filter-chip {
        font-size: 0.6875rem;
        padding: 0.375rem 0.625rem;
      }
      
      /* ë¦¬ìŠ¤íŠ¸ ë·° */
      .grid.grid-cols-1.gap-4 {
        gap: 0.625rem;
      }
      
      /* ì•Œë°” ì¹´ë“œ */
      .job-card {
        padding: 0.875rem;
      }
      
      .job-card .text-lg {
        font-size: 0.875rem;
      }
      
      .job-card .text-sm {
        font-size: 0.6875rem;
      }
      
      .job-card .text-xs {
        font-size: 0.625rem;
      }
      
      /* ì‹œê¸‰ í‘œì‹œ */
      .job-card .text-orange-500.text-2xl {
        font-size: 1.125rem;
      }
      
      /* íƒœê·¸ */
      .job-card .bg-gray-100 {
        font-size: 0.625rem;
        padding: 0.25rem 0.5rem;
      }
      
      /* ë°°ì§€ (ê¸‰êµ¬, ì™„ê¸°) */
      .job-card .bg-orange-500,
      .job-card .bg-green-500 {
        font-size: 0.625rem;
        padding: 0.25rem 0.5rem;
        font-weight: 600;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between max-w-1200px">
      <a href="/" class="flex items-center space-x-2">
        <img src="/albi-mascot.svg" alt="ì•Œë¹„" style="width: 32px; height: 32px;">
        <div class="flex flex-col">
          <span class="text-xl font-bold text-gray-800">ë‚´ ì£¼ë³€ ì•Œë°”</span>
          <span id="locationStatus" class="text-xs text-gray-500">ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...</span>
        </div>
      </a>
      <a href="/post-job" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition flex items-center gap-2">
        <i class="fas fa-plus"></i>
        <span class="hidden sm:inline">ê³µê³ ì˜¬ë¦¬ê¸°</span>
      </a>
    </div>
  </nav>

  <!-- ë·° í† ê¸€ íƒ­ -->
  <div class="bg-white border-b sticky top-16 z-40">
    <div class="container mx-auto px-4 max-w-1200px flex">
      <button onclick="switchView('list')" id="listTab" class="flex-1 py-3 text-sm font-bold text-orange-500 border-b-2 border-orange-500 transition">
        <i class="fas fa-list mr-1"></i> ë¦¬ìŠ¤íŠ¸
      </button>
      <button onclick="switchView('map')" id="mapTab" class="flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent transition hover:text-orange-500">
        <i class="fas fa-map mr-1"></i> ì§€ë„
      </button>
    </div>
  </div>

  <!-- í•„í„° ë°” -->
  <div class="bg-white px-4 py-3 border-b sticky top-28 z-40">
    <div class="container mx-auto max-w-1200px">
      <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide">
        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
        <button onclick="filterByCategory('all')" data-category="all" class="filter-chip active px-4 py-2 rounded-full border-2 text-sm whitespace-nowrap transition">
          ì „ì²´
        </button>
        <button onclick="filterByCategory('cafe')" data-category="cafe" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          â˜• ì¹´í˜
        </button>
        <button onclick="filterByCategory('convenience')" data-category="convenience" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          ğŸª í¸ì˜ì 
        </button>
        <button onclick="filterByCategory('restaurant')" data-category="restaurant" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          ğŸ½ï¸ ìŒì‹ì 
        </button>
        <button onclick="filterByCategory('fastfood')" data-category="fastfood" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          ğŸ” íŒ¨ìŠ¤íŠ¸í‘¸ë“œ
        </button>
        <button onclick="filterByCategory('retail')" data-category="retail" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          ğŸ‘• ë§¤ì¥
        </button>
        <button onclick="filterByCategory('other')" data-category="other" class="filter-chip px-4 py-2 rounded-full border-2 border-gray-300 text-sm whitespace-nowrap transition">
          ğŸ“¦ ê¸°íƒ€
        </button>
        
        <div class="w-px h-6 bg-gray-300 mx-2"></div>
        
        <!-- ì •ë ¬ í•„í„° -->
        <select id="sortFilter" onchange="filterJobs()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="distance">ê°€ê¹Œìš´ìˆœ</option>
          <option value="wage">ë†’ì€ì‹œê¸‰ìˆœ</option>
          <option value="views">ì¸ê¸°ìˆœ</option>
        </select>

        <button onclick="getCurrentLocation()" id="locationBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition ml-auto whitespace-nowrap">
          <i class="fas fa-location-arrow mr-1"></i>
          í˜„ìœ„ì¹˜
        </button>
      </div>
    </div>
  </div>

  <!-- ë¦¬ìŠ¤íŠ¸ ë·° -->
  <div id="listView" class="container mx-auto px-4 py-6 max-w-1200px mb-20">
    <!-- ë¡œë”© ìƒíƒœ -->
    <div id="loading" class="text-center py-12">
      <img src="/albi-mascot.svg" alt="ë¡œë”©" class="w-16 h-16 mx-auto mb-4 animate-bounce">
      <p class="text-gray-600">ì£¼ë³€ ì•Œë°”ë¥¼ ì°¾ê³  ìˆì–´ìš”...</p>
    </div>
    
    <!-- ê³µê³  ë¦¬ìŠ¤íŠ¸ -->
    <div id="jobsList" class="space-y-4">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <!-- ê²°ê³¼ ì—†ìŒ -->
    <div id="noResults" class="hidden text-center py-12">
      <div class="text-6xl mb-4">ğŸ˜¢</div>
      <h3 class="text-2xl font-bold text-gray-800 mb-2">ì£¼ë³€ì— ê³µê³ ê°€ ì—†ì–´ìš”</h3>
      <p class="text-gray-600 mb-6">ê²€ìƒ‰ ë°˜ê²½ì„ ë„“íˆê±°ë‚˜ ë‹¤ë¥¸ ì§€ì—­ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
      <button onclick="getCurrentLocation()" class="px-6 py-3 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
        <i class="fas fa-redo mr-2"></i>
        ë‹¤ì‹œ ê²€ìƒ‰
      </button>
    </div>
  </div>

  <!-- ì§€ë„ ë·° -->
  <div id="mapView" class="hidden relative">
    <div id="map"></div>
    <div class="absolute top-4 left-4 bg-white rounded-lg shadow-lg p-3 z-10">
      <p class="text-xs text-gray-600 flex items-center gap-2">
        <span class="w-3 h-3 bg-blue-500 rounded-full"></span> ë‚´ ìœ„ì¹˜
        <span class="w-3 h-3 bg-orange-500 rounded-full ml-2"></span> ì•Œë°” ê³µê³ 
      </p>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-50 md:hidden">
    <div class="grid grid-cols-4">
      <a href="/" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-home text-xl mb-1"></i>
        <span class="text-xs">í™ˆ</span>
      </a>
      <a href="/jobs" class="flex flex-col items-center py-3 text-orange-500">
        <i class="fas fa-briefcase text-xl mb-1"></i>
        <span class="text-xs">ì•Œë°”ì°¾ê¸°</span>
      </a>
      <a href="/community.html" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-comments text-xl mb-1"></i>
        <span class="text-xs">ì»¤ë®¤ë‹ˆí‹°</span>
      </a>
      <a href="/mypage.html" class="flex flex-col items-center py-3 text-gray-600 hover:text-orange-500">
        <i class="fas fa-user text-xl mb-1"></i>
        <span class="text-xs">MY</span>
      </a>
    </div>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
  <script>
    let currentLocation = { lat: 37.5665, lng: 126.9780 }; // ê¸°ë³¸: ì„œìš¸ì‹œì²­
    let allJobs = [];
    let map = null;
    let markers = [];
    let currentView = 'list';

    const categoryIcons = {
      cafe: 'â˜•',
      convenience: 'ğŸª', 
      restaurant: 'ğŸ½ï¸',
      retail: 'ğŸ‘•',
      delivery: 'ğŸ›µ',
      etc: 'ğŸ’¼'
    };

    // ì´ˆê¸°í™”
    window.onload = function() {
      getCurrentLocation();
    };

    // ë·° ì „í™˜
    function switchView(view) {
      console.log('ğŸ”„ ë·° ì „í™˜:', view);
      currentView = view;
      const listView = document.getElementById('listView');
      const mapView = document.getElementById('mapView');
      const listTab = document.getElementById('listTab');
      const mapTab = document.getElementById('mapTab');

      if (view === 'list') {
        listView.classList.remove('hidden');
        mapView.classList.add('hidden');
        listTab.className = 'flex-1 py-3 text-sm font-bold text-orange-500 border-b-2 border-orange-500 transition';
        mapTab.className = 'flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent transition hover:text-orange-500';
      } else {
        console.log('ğŸ“ ì§€ë„ ë·°ë¡œ ì „í™˜ ì‹œì‘');
        listView.classList.add('hidden');
        mapView.classList.remove('hidden');
        listTab.className = 'flex-1 py-3 text-sm font-bold text-gray-500 border-b-2 border-transparent transition hover:text-orange-500';
        mapTab.className = 'flex-1 py-3 text-sm font-bold text-orange-500 border-b-2 border-orange-500 transition';
        
        console.log('ğŸ—ºï¸ ì§€ë„ ê°ì²´ ì¡´ì¬:', !!map);
        if (!map) {
          console.log('ğŸ†• ìƒˆ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
          initMap();
        } else if (map.relayout) {
          console.log('ğŸ”„ ì§€ë„ ë ˆì´ì•„ì›ƒ ì¡°ì •');
          map.relayout();
        }
      }
    }
    
    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function filterByCategory(category) {
      document.querySelectorAll('.filter-chip').forEach(chip => {
        if (chip.dataset.category === category) {
          chip.classList.add('active');
        } else {
          chip.classList.remove('active');
        }
      });
      
      filterJobs();
    }

    // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
    function getCurrentLocation() {
      console.log('ğŸ“ í˜„ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ë¨');
      const btn = document.getElementById('locationBtn');
      const status = document.getElementById('locationStatus');
      
      if (!btn) {
        console.error('âŒ locationBtn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> í™•ì¸ì¤‘...';
      btn.disabled = true;

      if (!navigator.geolocation) {
        console.warn('âš ï¸ ìœ„ì¹˜ ì„œë¹„ìŠ¤ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €');
        alert('ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
        btn.innerHTML = '<i class="fas fa-location-arrow mr-1"></i> í˜„ìœ„ì¹˜';
        btn.disabled = false;
        loadJobs();
        return;
      }

      console.log('ğŸ” ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ ì¤‘...');
      navigator.geolocation.getCurrentPosition(
        (position) => {
          currentLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          console.log('âœ… ìœ„ì¹˜ íšë“ ì„±ê³µ:', currentLocation);
          status.textContent = 'ë°˜ê²½ 3km ë‚´ ê³µê³ ';
          btn.innerHTML = '<i class="fas fa-check-circle mr-1"></i> í˜„ìœ„ì¹˜';
          btn.className = 'px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-semibold ml-auto whitespace-nowrap';
          btn.disabled = false;
          
          // ì§€ë„ ë·°ì¸ ê²½ìš° ì§€ë„ ì¤‘ì‹¬ ì´ë™
          if (currentView === 'map' && map) {
            const newCenter = new kakao.maps.LatLng(currentLocation.lat, currentLocation.lng);
            map.setCenter(newCenter);
            console.log('ğŸ—ºï¸ ì§€ë„ ì¤‘ì‹¬ ì´ë™:', currentLocation);
          }
          
          loadJobs();
        },
        (error) => {
          console.error('âŒ ìœ„ì¹˜ íšë“ ì‹¤íŒ¨:', error.message, error.code);
          status.textContent = 'ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤';
          btn.innerHTML = '<i class="fas fa-location-arrow mr-1"></i> í˜„ìœ„ì¹˜';
          btn.disabled = false;
          loadJobs(); // ê¸°ë³¸ ìœ„ì¹˜ë¡œ ë¡œë“œ
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }

    // ê³µê³  ë°ì´í„° ë¡œë“œ
    async function loadJobs() {
      try {
        document.getElementById('loading').classList.remove('hidden');
        
        const activeChip = document.querySelector('.filter-chip.active');
        const category = activeChip ? activeChip.dataset.category : 'all';
        const sort = document.getElementById('sortFilter').value;
        
        const params = new URLSearchParams({
          lat: currentLocation.lat.toString(),
          lng: currentLocation.lng.toString(),
          radius: '3',
          category,
          sort
        });

        const response = await axios.get(`/api/jobs/nearby?${params}`);

        if (response.data.success) {
          allJobs = response.data.data.jobs;
          renderJobs();
          if (currentView === 'map') updateMap();
        } else {
          throw new Error(response.data.error);
        }
      } catch (error) {
        console.error('Load jobs error:', error);
        // ëª©ì—… ë°ì´í„°ë¡œ ëŒ€ì²´
        renderMockJobs();
      } finally {
        document.getElementById('loading').classList.add('hidden');
      }
    }

    // ëª©ì—… ë°ì´í„°ë¡œ ê³µê³  ë Œë”ë§
    function renderMockJobs() {
      const mockJobs = [
        {
          id: 1,
          category: 'cafe',
          title: 'ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì  ë°”ë¦¬ìŠ¤íƒ€',
          location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
          distance: 0.8,
          hourly_wage: 12000,
          tags: ['ì¥ê¸°', 'ì£¼ë§', 'ì˜¤ì „'],
          views: 234,
          has_trial: true
        },
        {
          id: 2,
          category: 'convenience',
          title: 'CU ì—­ì‚¼ì  ì•¼ê°„ ì•Œë°”',
          location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
          distance: 1.2,
          hourly_wage: 13500,
          tags: ['ì•¼ê°„', 'ë‹¨ê¸°ê°€ëŠ¥', 'ê¸‰êµ¬'],
          views: 456,
          has_trial: true
        },
        {
          id: 3,
          category: 'restaurant',
          title: 'í•œì‹ë‹¹ í™€ì„œë¹™',
          location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
          distance: 1.5,
          hourly_wage: 11000,
          tags: ['ì¥ê¸°', 'ì‹ì‚¬ì œê³µ', 'ì£¼ì¤‘'],
          views: 189,
          has_trial: true
        },
        {
          id: 4,
          category: 'retail',
          title: 'ì˜ë¥˜ë§¤ì¥ íŒë§¤ì§',
          location: 'ì„œìš¸ ê°•ë‚¨êµ¬',
          distance: 2.1,
          hourly_wage: 12500,
          tags: ['ì£¼ë§', 'ì¥ê¸°', 'ì¸ì„¼í‹°ë¸Œ'],
          views: 345,
          has_trial: true
        }
      ];

      allJobs = mockJobs;
      renderJobs();
    }

    // ê³µê³  ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    function renderJobs() {
      const container = document.getElementById('jobsList');
      const noResults = document.getElementById('noResults');

      if (allJobs.length === 0) {
        container.innerHTML = '';
        noResults.classList.remove('hidden');
        return;
      }

      noResults.classList.add('hidden');
      
      container.innerHTML = allJobs.map(job => `
        <div onclick="viewJobDetail('${job.id}')" class="job-card bg-white rounded-lg border border-gray-200 p-4 cursor-pointer transition-all">
          <div class="flex items-start gap-3 mb-3">
            <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl flex-shrink-0">
              ${categoryIcons[job.category] || 'ğŸ’¼'}
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="text-base font-bold text-gray-800 mb-1 truncate">${job.title}</h3>
              <div class="flex items-center gap-1.5 text-xs text-gray-600 mb-1">
                <i class="fas fa-map-marker-alt text-orange-500 text-xs"></i>
                <span class="truncate">${job.location}</span>
              </div>
              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-lg font-bold text-orange-500">${job.hourly_wage.toLocaleString()}ì›</span>
                ${job.distance ? `<span class="px-2 py-0.5 bg-blue-100 text-blue-600 rounded-full text-xs font-semibold">${job.distance}km</span>` : ''}
              </div>
            </div>
          </div>
          
          <div class="flex items-center gap-1.5 flex-wrap text-xs">
            ${job.has_trial ? '<span class="px-2 py-1 bg-orange-100 text-orange-600 rounded-full font-semibold whitespace-nowrap"><i class="fas fa-eye mr-0.5"></i>ì²´í—˜</span>' : ''}
            ${(job.tags || []).slice(0, 2).map(tag => `
              <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded-full whitespace-nowrap">#${tag}</span>
            `).join('')}
            <span class="px-2 py-1 text-gray-500 ml-auto flex items-center gap-1 whitespace-nowrap">
              <i class="fas fa-eye"></i> ${job.views || 0}
            </span>
          </div>
        </div>
      `).join('');
    }

    // ì§€ë„ ì´ˆê¸°í™” (Kakao Maps)
    function initMap() {
      console.log('ğŸ—ºï¸ initMap í˜¸ì¶œë¨');
      
      // Kakao Maps APIê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì¬ì‹œë„
      if (typeof kakao === 'undefined' || !kakao.maps) {
        console.log('â³ Kakao Maps API ë¡œë”© ëŒ€ê¸° ì¤‘...');
        let retryCount = 0;
        const maxRetries = 10;
        
        const checkKakao = setInterval(() => {
          retryCount++;
          console.log(`ğŸ”„ Kakao ë¡œë“œ ì²´í¬ ì‹œë„ ${retryCount}/${maxRetries}`);
          
          if (typeof kakao !== 'undefined' && kakao.maps) {
            console.log('âœ… Kakao Maps API ë¡œë“œ ì™„ë£Œ!');
            clearInterval(checkKakao);
            initMapInternal();
          } else if (retryCount >= maxRetries) {
            console.error('âŒ Kakao Maps API ë¡œë“œ ì‹œê°„ ì´ˆê³¼');
            clearInterval(checkKakao);
            document.getElementById('mapView').innerHTML = 
              `<div class="flex items-center justify-center h-screen bg-gray-50">
                <div class="text-center max-w-2xl px-4">
                  <div class="text-6xl mb-4">ğŸ—ºï¸</div>
                  <p class="text-gray-800 font-bold text-xl mb-2">ì§€ë„ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                  <p class="text-gray-600 text-sm mb-4">
                    Kakao ì§€ë„ API í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                    ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                  </p>
                  <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4 text-left">
                    <p class="text-sm text-gray-700 font-semibold mb-2">ğŸ“ ê°œë°œì ì•ˆë‚´:</p>
                    <ol class="text-xs text-gray-600 space-y-1 ml-4">
                      <li>1. Kakao Developers (developers.kakao.com) ì ‘ì†</li>
                      <li>2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ì•± ì„ íƒ/ìƒì„±</li>
                      <li>3. ì•± í‚¤ â†’ JavaScript í‚¤ ë³µì‚¬</li>
                      <li>4. jobs.html 10ë²ˆ ì¤„ì˜ appkey ê°’ êµì²´</li>
                      <li>5. í”Œë«í¼ ì„¤ì • â†’ Web ë„ë©”ì¸ ë“±ë¡ (albi-app.pages.dev)</li>
                    </ol>
                  </div>
                  <button onclick="switchView('list')" class="px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition font-semibold">
                    <i class="fas fa-list mr-2"></i>ëª©ë¡ìœ¼ë¡œ ë³´ê¸°
                  </button>
                </div>
              </div>`;
          }
        }, 300); // 300msë§ˆë‹¤ ì²´í¬
        return;
      }
      
      // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ë°”ë¡œ ì´ˆê¸°í™”
      console.log('âœ… Kakao Maps API ì´ë¯¸ ì‚¬ìš© ê°€ëŠ¥');
      initMapInternal();
    }
    
    // ì‹¤ì œ ì§€ë„ ì´ˆê¸°í™” ë¡œì§
    function initMapInternal() {
      console.log('ğŸ¯ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');

      const container = document.getElementById('map');
      console.log('ğŸ“ ì§€ë„ ì»¨í…Œì´ë„ˆ:', container);
      console.log('ğŸ“ í˜„ì¬ ìœ„ì¹˜:', currentLocation);
      
      const options = {
        center: new kakao.maps.LatLng(currentLocation.lat, currentLocation.lng),
        level: 5
      };

      console.log('ğŸ—ºï¸ ì§€ë„ ìƒì„± ì¤‘...');
      map = new kakao.maps.Map(container, options);
      
      // ì¤Œ ì»¨íŠ¸ë¡¤ ì¶”ê°€
      const zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.LEFT);
      
      console.log('âœ… ì§€ë„ ìƒì„± ì™„ë£Œ:', map);
      updateMap();
    }

    // ì§€ë„ ë§ˆì»¤ ì—…ë°ì´íŠ¸ (Kakao Maps)
    function updateMap() {
      if (!map || !window.kakao) return;

      markers.forEach(marker => marker.setMap(null));
      markers = [];

      // ë‚´ ìœ„ì¹˜ ë§ˆì»¤
      const myPosition = new kakao.maps.LatLng(currentLocation.lat, currentLocation.lng);
      const myMarker = new kakao.maps.Marker({
        position: myPosition,
        map: map,
        image: new kakao.maps.MarkerImage(
          'data:image/svg+xml;utf8,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="8" fill="%233B82F6" stroke="white" stroke-width="3"/></svg>',
          new kakao.maps.Size(20, 20)
        )
      });
      markers.push(myMarker);

      // ì•Œë°” ë§ˆì»¤ë“¤
      allJobs.forEach(job => {
        if (!job.latitude || !job.longitude) return;

        const position = new kakao.maps.LatLng(job.latitude, job.longitude);
        
        // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¡œ ì‹œê¸‰ í‘œì‹œ (DOM ìš”ì†Œ ìƒì„±)
        const markerDiv = document.createElement('div');
        markerDiv.style.cssText = 'background: white; padding: 6px 10px; border-radius: 16px; border: 2px solid #FF6B35; font-size: 12px; font-weight: 600; color: #FF6B35; box-shadow: 0 2px 6px rgba(0,0,0,0.2); white-space: nowrap; cursor: pointer;';
        markerDiv.innerHTML = `${job.hourly_wage.toLocaleString()}ì›`;
        
        const customOverlay = new kakao.maps.CustomOverlay({
          position: position,
          content: markerDiv,
          yAnchor: 1.5
        });
        customOverlay.setMap(map);
        markers.push(customOverlay);

        // ì •ë³´ ì°½ ìƒì„± (DOM ìš”ì†Œ ìƒì„±)
        const infoDiv = document.createElement('div');
        infoDiv.style.cssText = 'padding:15px; min-width:220px; text-align:center; background:white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
        infoDiv.innerHTML = `
          <div style="font-weight:bold; margin-bottom:8px; font-size: 14px; color: #333;">${job.title}</div>
          <div style="color:#f97316; font-weight:bold; font-size:18px; margin-bottom:8px;">
            ì‹œê¸‰ ${job.hourly_wage.toLocaleString()}ì›
          </div>
          <div style="color:#666; font-size:13px; margin-bottom:10px;">
            ğŸ“ ${job.distance}km Â· ${job.company_name || job.company}
          </div>
          <button data-job-id="${job.id}" class="job-detail-btn"
                  style="background:#f97316; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:13px; font-weight: 600;">
            ìƒì„¸ë³´ê¸°
          </button>
        `;
        
        const infoOverlay = new kakao.maps.CustomOverlay({
          content: infoDiv,
          position: position,
          yAnchor: 2.5
        });

        // ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        const detailBtn = infoDiv.querySelector('.job-detail-btn');
        detailBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          viewJobDetail(job.id);
        });

        // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
        markerDiv.addEventListener('click', () => {
          // ë‹¤ë¥¸ ì •ë³´ì°½ ë‹«ê¸°
          markers.forEach(m => {
            if (m._isInfoWindow) {
              m.setMap(null);
            }
          });
          
          infoOverlay._isInfoWindow = true;
          infoOverlay.setMap(map);
          markers.push(infoOverlay);
        });
      });
    }

    // í•„í„° ë³€ê²½ ì‹œ ì¬ê²€ìƒ‰
    function filterJobs() {
      loadJobs();
    }

    // ê³µê³  ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
    function viewJobDetail(jobId) {
      window.location.href = `/job-detail.html?id=${jobId}`;
    }
  </script>
</body>
</html>
