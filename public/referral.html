<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸° - ì•Œë¹„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .referral-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .share-btn:hover {
            transform: scale(1.05);
        }
        .share-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-8">
        <div class="max-w-4xl mx-auto px-4">
            <div class="flex items-center justify-between mb-4">
                <a href="/" class="text-white hover:text-gray-200">
                    <i class="fas fa-arrow-left mr-2"></i> í™ˆìœ¼ë¡œ
                </a>
                <div class="flex items-center gap-2">
                    <i class="fas fa-gift text-2xl"></i>
                    <span class="text-sm bg-white/20 px-3 py-1 rounded-full">
                        <span id="userPointsBadge">0 P</span>
                    </span>
                </div>
            </div>
            <h1 class="text-3xl font-bold mb-2">
                <i class="fas fa-user-friends mr-2"></i>
                ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°
            </h1>
            <p class="text-white/90">ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ê³  í•¨ê»˜ í¬ì¸íŠ¸ë¥¼ ë°›ì•„ìš”! ğŸ</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- ë³´ìƒ ì•ˆë‚´ ì¹´ë“œ -->
        <div class="referral-card text-white rounded-2xl p-6 mb-8 shadow-lg fade-in">
            <h2 class="text-2xl font-bold mb-4 flex items-center">
                <i class="fas fa-coins mr-2"></i>
                ì¹œêµ¬ ì´ˆëŒ€ ì´ë²¤íŠ¸
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white/20 rounded-xl p-4">
                    <div class="text-4xl mb-2">ğŸ</div>
                    <div class="font-bold text-lg mb-1">ì¹œêµ¬ê°€ ê°€ì…í•˜ë©´</div>
                    <div class="text-3xl font-bold">+20P</div>
                    <div class="text-sm text-white/80 mt-2">ì¦‰ì‹œ ì§€ê¸‰!</div>
                </div>
                <div class="bg-white/20 rounded-xl p-4">
                    <div class="text-4xl mb-2">ğŸ‰</div>
                    <div class="font-bold text-lg mb-1">ì¹œêµ¬ê°€ ì±„ìš©ë˜ë©´</div>
                    <div class="text-3xl font-bold">+10P</div>
                    <div class="text-sm text-white/80 mt-2">ì¶”ì²œì¸ì—ê²Œ ì§€ê¸‰!</div>
                </div>
            </div>
        </div>

        <!-- ë‚´ ì¶”ì²œ ì½”ë“œ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-qrcode mr-2 text-purple-600"></i>
                ë‚´ ì¶”ì²œ ì½”ë“œ
            </h2>
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border-2 border-purple-200 text-center">
                <div class="text-gray-600 mb-2">ë‚´ ì½”ë“œ</div>
                <div id="referralCode" class="text-4xl font-bold text-purple-600 mb-4 tracking-wider">
                    ALBI------
                </div>
                <div class="text-sm text-gray-500 mb-4" id="inviteLink">
                    ì´ˆëŒ€ ë§í¬ ìƒì„± ì¤‘...
                </div>
                <div class="flex gap-2 justify-center">
                    <button onclick="copyCode()" class="share-btn bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-all">
                        <i class="fas fa-copy mr-2"></i>
                        ì½”ë“œ ë³µì‚¬
                    </button>
                    <button onclick="copyLink()" class="share-btn bg-pink-600 text-white px-6 py-3 rounded-lg hover:bg-pink-700 transition-all">
                        <i class="fas fa-link mr-2"></i>
                        ë§í¬ ë³µì‚¬
                    </button>
                    <button onclick="shareKakao()" class="share-btn bg-yellow-400 text-gray-800 px-6 py-3 rounded-lg hover:bg-yellow-500 transition-all">
                        <i class="fas fa-comment mr-2"></i>
                        ì¹´í†¡ ê³µìœ 
                    </button>
                </div>
            </div>
        </div>

        <!-- ì¶”ì²œ í†µê³„ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-chart-bar mr-2 text-blue-600"></i>
                ë‚´ ì¶”ì²œ í˜„í™©
            </h2>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="text-center p-4 bg-blue-50 rounded-xl">
                    <div class="text-3xl font-bold text-blue-600" id="totalReferrals">0</div>
                    <div class="text-sm text-gray-600 mt-1">ì´ ì¶”ì²œ</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-xl">
                    <div class="text-3xl font-bold text-green-600" id="successReferrals">0</div>
                    <div class="text-sm text-gray-600 mt-1">ì±„ìš© ì„±ê³µ</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-xl">
                    <div class="text-3xl font-bold text-purple-600" id="totalEarned">0 P</div>
                    <div class="text-sm text-gray-600 mt-1">íšë“ í¬ì¸íŠ¸</div>
                </div>
            </div>

            <!-- ìµœê·¼ ì¶”ì²œ ì¹œêµ¬ -->
            <h3 class="font-bold mb-3 text-gray-700">ìµœê·¼ ì¶”ì²œ ì¹œêµ¬</h3>
            <div id="recentReferrals" class="space-y-2">
                <div class="text-center py-8 text-gray-400">
                    <i class="fas fa-user-plus text-4xl mb-3"></i>
                    <p>ì•„ì§ ì¶”ì²œí•œ ì¹œêµ¬ê°€ ì—†ì–´ìš”</p>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš© ë°©ë²• -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 mb-8 fade-in">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-question-circle mr-2 text-blue-600"></i>
                ì¹œêµ¬ ì´ˆëŒ€ ë°©ë²•
            </h2>
            <div class="space-y-3">
                <div class="flex items-start gap-3">
                    <div class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold">1</div>
                    <div>
                        <div class="font-bold text-gray-800">ì¶”ì²œ ì½”ë“œ ê³µìœ </div>
                        <div class="text-sm text-gray-600">ìœ„ì˜ ë²„íŠ¼ìœ¼ë¡œ ì¹œêµ¬ì—ê²Œ ì½”ë“œë‚˜ ë§í¬ë¥¼ ì „ë‹¬í•˜ì„¸ìš”</div>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold">2</div>
                    <div>
                        <div class="font-bold text-gray-800">ì¹œêµ¬ ê°€ì…</div>
                        <div class="text-sm text-gray-600">ì¹œêµ¬ê°€ ì¶”ì²œ ì½”ë“œë¡œ íšŒì›ê°€ì…í•˜ë©´ <span class="font-bold text-pink-600">ì¹œêµ¬ì—ê²Œ 20P ì¦‰ì‹œ ì§€ê¸‰</span></div>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold">3</div>
                    <div>
                        <div class="font-bold text-gray-800">ì±„ìš© ì„±ê³µ</div>
                        <div class="text-sm text-gray-600">ì¹œêµ¬ê°€ ì±„ìš©ë˜ë©´ <span class="font-bold text-purple-600">ë‚˜ì—ê²Œ 10P ì¶”ê°€ ì§€ê¸‰</span></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        // ì‚¬ìš©ì ì •ë³´ (ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
        let currentUserId = localStorage.getItem('albi_user_id') || 'user001';
        let referralData = {
            code: '',
            link: ''
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function loadReferralData() {
            try {
                // 1. ì¶”ì²œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
                const codeResponse = await axios.get(`/api/referral/my-code/${currentUserId}`);
                if (codeResponse.data.success) {
                    referralData.code = codeResponse.data.data.referralCode;
                    referralData.link = codeResponse.data.data.inviteLink;
                    
                    document.getElementById('referralCode').textContent = referralData.code;
                    document.getElementById('inviteLink').textContent = referralData.link;
                }

                // 2. í†µê³„ ê°€ì ¸ì˜¤ê¸°
                const statsResponse = await axios.get(`/api/referral/stats/${currentUserId}`);
                if (statsResponse.data.success) {
                    const stats = statsResponse.data.data;
                    document.getElementById('totalReferrals').textContent = stats.totalReferrals;
                    document.getElementById('successReferrals').textContent = stats.successfulReferrals;
                    document.getElementById('totalEarned').textContent = stats.totalEarned + ' P';

                    // ìµœê·¼ ì¶”ì²œ ì¹œêµ¬ í‘œì‹œ
                    displayRecentReferrals(stats.recentReferrals);
                }

                // 3. í¬ì¸íŠ¸ ê°€ì ¸ì˜¤ê¸°
                const userPoints = localStorage.getItem('albi_points') || 0;
                document.getElementById('userPointsBadge').textContent = userPoints + ' P';

            } catch (error) {
                console.error('Error loading referral data:', error);
                showNotification('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ìµœê·¼ ì¶”ì²œ ì¹œêµ¬ í‘œì‹œ
        function displayRecentReferrals(referrals) {
            const container = document.getElementById('recentReferrals');
            
            if (!referrals || referrals.length === 0) {
                return;
            }

            container.innerHTML = referrals.map(ref => {
                const statusBadge = ref.status === 'hired' 
                    ? '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">ì±„ìš© ì„±ê³µ âœ…</span>'
                    : '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">ê°€ì… ì™„ë£Œ</span>';
                
                const date = new Date(ref.created_at * 1000).toLocaleDateString('ko-KR');
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-bold">
                                ${ref.referee_name ? ref.referee_name[0] : '?'}
                            </div>
                            <div>
                                <div class="font-bold text-gray-800">${ref.referee_name || 'ìµëª…'}</div>
                                <div class="text-sm text-gray-500">${date}</div>
                            </div>
                        </div>
                        ${statusBadge}
                    </div>
                `;
            }).join('');
        }

        // ì½”ë“œ ë³µì‚¬
        function copyCode() {
            navigator.clipboard.writeText(referralData.code).then(() => {
                showNotification('ì¶”ì²œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹', 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // ë§í¬ ë³µì‚¬
        function copyLink() {
            navigator.clipboard.writeText(referralData.link).then(() => {
                showNotification('ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ”—', 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
        function shareKakao() {
            const text = `ì•Œë¹„ì—ì„œ í•¨ê»˜ ì¼ìë¦¬ë¥¼ ì°¾ì•„ìš”! ğŸœ\n\në‚´ ì¶”ì²œ ì½”ë“œ: ${referralData.code}\nê°€ì…í•˜ë©´ 20P ì¦‰ì‹œ ì§€ê¸‰!\n\n${referralData.link}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ì•Œë¹„ ì¹œêµ¬ ì´ˆëŒ€',
                    text: text,
                }).then(() => {
                    showNotification('ê³µìœ  ì„±ê³µ!', 'success');
                }).catch(err => {
                    console.error('ê³µìœ  ì‹¤íŒ¨:', err);
                });
            } else {
                // ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš° ë§í¬ ë³µì‚¬
                copyLink();
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-bold fade-in ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadReferralData);
    </script>
</body>
</html>
